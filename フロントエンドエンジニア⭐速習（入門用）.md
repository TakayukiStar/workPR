# 🔧 トラブルシューティングガイド
## よくあるエラーと解決方法

---

## 🐍 Python / Flask エラー

### エラー1: ModuleNotFoundError
```
ModuleNotFoundError: No module named 'flask'
```

**原因:** 必要なパッケージがインストールされていない

**解決方法:**
```bash
# 仮想環境が有効か確認
# プロンプトに (venv) が表示されているか

# パッケージをインストール
pip install flask
pip install -r requirements.txt
```

---

### エラー2: ImportError
```
ImportError: cannot import name 'Flask' from 'flask'
```

**原因:** インストールが不完全、または競合

**解決方法:**
```bash
# アンインストール
pip uninstall flask

# 再インストール
pip install --no-cache-dir flask
```

---

### エラー3: Address already in use
```
OSError: [Errno 48] Address already in use
```

**原因:** ポート5000が既に使用されている

**解決方法:**
```python
# app.py を変更
if __name__ == '__main__':
    app.run(debug=True, port=5001)  # ポート番号を変更
```

または

```bash
# Windowsの場合（プロセスを終了）
netstat -ano | findstr :5000
taskkill /PID <プロセスID> /F

# Mac/Linuxの場合
lsof -ti:5000 | xargs kill -9
```

---

### エラー4: TemplateNotFound
```
jinja2.exceptions.TemplateNotFound: index.html
```

**原因:** テンプレートファイルが見つからない

**解決方法:**
1. `templates/` フォルダーが存在するか確認
2. ファイル名が正しいか確認（大文字小文字も）
3. app.pyと同じ階層にtemplatesフォルダーがあるか確認

```
正しい構造:
project/
├── app.py
└── templates/
    └── index.html
```

---

### エラー5: KeyError in environment variables
```
KeyError: 'GOOGLE_AI_API_KEY'
```

**原因:** 環境変数が設定されていない

**解決方法:**
```python
# .envファイルを作成
# GOOGLE_AI_API_KEY=your_key_here

# app.pyで確認
from dotenv import load_dotenv
import os

load_dotenv()
API_KEY = os.getenv("GOOGLE_AI_API_KEY")

if not API_KEY:
    print("⚠️ APIキーが設定されていません")
    exit(1)
```

---

### エラー6: werkzeug.routing.BuildError
```
werkzeug.routing.BuildError: Could not build url for endpoint 'static'
```

**原因:** static フォルダーが存在しない

**解決方法:**
```bash
mkdir static
mkdir static/css
mkdir static/js
mkdir static/images
```

---

### エラー7: UnicodeDecodeError
```
UnicodeDecodeError: 'cp932' codec can't decode byte
```

**原因:** ファイルのエンコーディングが正しくない

**解決方法:**
```python
# encoding='utf-8' を明示的に指定
with open('file.txt', 'r', encoding='utf-8') as f:
    content = f.read()

# CSVの場合も同様
with open('data.csv', 'r', encoding='utf-8') as f:
    reader = csv.reader(f)
```

---

## 💻 JavaScript エラー

### エラー8: Uncaught TypeError: Cannot read property
```
Uncaught TypeError: Cannot read property 'value' of null
```

**原因:** 要素が存在しない

**解決方法:**
```javascript
// エラーが出るコード
const input = document.getElementById('myInput');
const value = input.value;  // inputがnullの場合エラー

// 修正版
const input = document.getElementById('myInput');
if (input) {
    const value = input.value;
} else {
    console.error('要素が見つかりません');
}

// または
const value = document.getElementById('myInput')?.value || '';
```

---

### エラー9: SyntaxError: Unexpected token
```
SyntaxError: Unexpected token < in JSON at position 0
```

**原因:** サーバーがJSONではなくHTMLを返している

**解決方法:**
```javascript
// レスポンスを確認
fetch('/api/data')
    .then(res => {
        console.log('Status:', res.status);
        console.log('Content-Type:', res.headers.get('content-type'));
        
        if (!res.ok) {
            throw new Error(`HTTP error! status: ${res.status}`);
        }
        
        return res.json();
    })
    .then(data => console.log(data))
    .catch(error => console.error('Error:', error));
```

```python
# サーバー側でJSONを返しているか確認
@app.route('/api/data')
def api_data():
    return jsonify({'key': 'value'})  # これは正しい
    # return "Hello"  # これはNG（JSONではない）
```

---

### エラー10: CORS policy error
```
Access to fetch at 'http://...' has been blocked by CORS policy
```

**原因:** クロスオリジンリクエストがブロックされている

**解決方法:**
```bash
pip install flask-cors
```

```python
from flask_cors import CORS

app = Flask(__name__)
CORS(app)
```

---

### エラー11: Promise rejection
```
Uncaught (in promise) TypeError: Failed to fetch
```

**原因:** ネットワークエラーまたはサーバーが起動していない

**解決方法:**
```javascript
// エラーハンドリングを追加
async function fetchData() {
    try {
        const response = await fetch('/api/data');
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log(data);
    } catch (error) {
        console.error('Fetch error:', error);
        alert('サーバーとの通信に失敗しました');
    }
}
```

1. サーバーが起動しているか確認
2. URLが正しいか確認
3. ネットワーク接続を確認

---

### エラー12: Async function error
```
SyntaxError: await is only valid in async functions
```

**原因:** async宣言のない関数でawaitを使用

**解決方法:**
```javascript
// エラーが出るコード
function fetchData() {
    const res = await fetch('/api/data');  // エラー
}

// 修正版
async function fetchData() {
    const res = await fetch('/api/data');  // OK
}
```

---

## 📁 ファイル操作エラー

### エラー13: FileNotFoundError
```
FileNotFoundError: [Errno 2] No such file or directory
```

**原因:** ファイルまたはディレクトリが存在しない

**解決方法:**
```python
from pathlib import Path

# ディレクトリを作成してからファイルを保存
folder = Path('uploads')
folder.mkdir(exist_ok=True)

filepath = folder / 'file.txt'
with open(filepath, 'w') as f:
    f.write('content')
```

---

### エラー14: PermissionError
```
PermissionError: [Errno 13] Permission denied
```

**原因:** ファイルへのアクセス権限がない

**解決方法:**
1. ファイルが別のプログラムで開かれていないか確認
2. 管理者権限で実行
3. ファイルの読み書き権限を確認

```python
# ファイルが使用中か確認
try:
    with open('file.txt', 'w') as f:
        f.write('test')
except PermissionError:
    print('ファイルが使用中です')
```

---

## 🌐 API関連エラー

### エラー15: API authentication failed
```
Error: Invalid API key
```

**原因:** APIキーが無効または期限切れ

**解決方法:**
1. APIキーを再確認
2. .envファイルのキーを更新
3. APIキーに余分なスペースがないか確認

```bash
# .envファイルを確認
# 間違い
GOOGLE_AI_API_KEY= AIzaSy...  # 余分なスペース

# 正しい
GOOGLE_AI_API_KEY=AIzaSy...
```

---

### エラー16: Rate limit exceeded
```
Error: 429 Too Many Requests
```

**原因:** APIの使用制限を超えた

**解決方法:**
```python
import time

# リクエスト間に待機時間を追加
for i in range(10):
    response = api_call()
    time.sleep(1)  # 1秒待機
```

---

### エラー17: Connection timeout
```
Error: Connection timeout
```

**原因:** ネットワーク接続の問題

**解決方法:**
```python
import requests
from requests.exceptions import Timeout

try:
    response = requests.get(url, timeout=10)  # タイムアウトを設定
except Timeout:
    print('リクエストがタイムアウトしました')
except requests.exceptions.RequestException as e:
    print(f'ネットワークエラー: {e}')
```

---

## 🎨 CSS / レイアウト問題

### 問題18: スタイルが反映されない

**原因:** 
- CSSファイルが読み込まれていない
- CSSセレクターが間違っている
- キャッシュの問題

**解決方法:**
```html
<!-- 1. CSSファイルのパスを確認 -->
<link rel="stylesheet" href="/static/css/style.css">

<!-- 2. インラインスタイルで確認 -->
<div style="color: red;">テスト</div>

<!-- 3. ブラウザのキャッシュをクリア -->
<!-- Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac) -->
```

```javascript
// JavaScriptでスタイルを確認
const element = document.getElementById('myElement');
console.log(window.getComputedStyle(element));
```

---

### 問題19: レスポンシブが効かない

**原因:** viewportメタタグが無い

**解決方法:**
```html
<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- この行を追加 -->
</head>
```

---

## 🔍 デバッグ手順

### ステップ1: エラーメッセージを読む
```
最初の行と最後の行を確認
- エラーの種類
- どこで発生したか
- 何が問題か
```

### ステップ2: ブラウザの開発者ツールを使う
```
F12 を押す

Console タブ:
- JavaScriptエラーを確認
- console.log の出力を確認

Network タブ:
- APIリクエストを確認
- レスポンスステータスを確認
- レスポンス内容を確認

Elements タブ:
- HTMLの構造を確認
- CSSスタイルを確認
```

### ステップ3: print / console.log デバッグ
```python
# Python
@app.route('/api/data', methods=['POST'])
def api_data():
    print("=== デバッグ開始 ===")
    data = request.json
    print(f"受信データ: {data}")
    print(f"データ型: {type(data)}")
    print("=== デバッグ終了 ===")
    return jsonify({'result': 'ok'})
```

```javascript
// JavaScript
async function sendData() {
    console.log('=== デバッグ開始 ===');
    const data = {message: 'test'};
    console.log('送信データ:', data);
    
    const response = await fetch('/api/data', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(data)
    });
    
    console.log('レスポンスステータス:', response.status);
    const result = await response.json();
    console.log('受信データ:', result);
    console.log('=== デバッグ終了 ===');
}
```

### ステップ4: 最小限のコードで再現
```python
# 複雑なコードを簡略化
# 問題を切り分ける

# 例: APIが動かない場合
# ↓ まずは最小限で確認
@app.route('/test')
def test():
    return jsonify({'test': 'ok'})
```

---

## 📋 チェックリスト

問題が発生したら、この順番で確認：

### Python/Flask
- [ ] 仮想環境が有効か
- [ ] 必要なパッケージがインストールされているか
- [ ] .envファイルが存在し、正しいか
- [ ] Flaskサーバーが起動しているか
- [ ] ルートのパスが正しいか
- [ ] templatesフォルダーが存在するか

### JavaScript
- [ ] ブラウザのコンソールにエラーが出ていないか
- [ ] Network タブでリクエストが送信されているか
- [ ] URLパスが正しいか
- [ ] Content-Typeが正しいか
- [ ] JSONの形式が正しいか

### ファイル
- [ ] ファイル名が正しいか（大文字小文字含む）
- [ ] ディレクトリが存在するか
- [ ] パスが正しいか
- [ ] エンコーディングが utf-8 か

---

## 💡 困ったときの行動

1. **エラーメッセージをよく読む**
   - どこで起きたか
   - 何が問題か

2. **Google検索**
   - エラーメッセージで検索
   - "Python" "Flask" などのキーワードを追加

3. **公式ドキュメント**
   - Flask: https://flask.palletsprojects.com/
   - MDN: https://developer.mozilla.org/

4. **コミュニティ**
   - Stack Overflow
   - GitHub Issues

5. **一旦休憩**
   - 新鮮な視点で再挑戦

---

**困ったときはこのガイドを見直してください！** 🔧

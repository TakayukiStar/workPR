# vi/vim 世界一詳しい初心者ガイド

## vi/vimとは? 💻

**vi**(ヴィアイ、**V**isual **I**nterface の略)は、1976年にビル・ジョイが開発した、Unix/Linuxシステムで標準的に使われるテキストエディタです。**vim**(ヴィム、**V**i **IM**proved の略)は1991年にブラム・ムーレナーがviの拡張版として開発しました。現在ではvimが広く使われており、viコマンドを実行してもvimが起動することが多いです。

### ちょっと待って、なぜ今さら古いエディタを？🤔

確かに、メモ帳やVS Codeなど使いやすいエディタはたくさんあります。でもvi/vimを学ぶ価値は絶大です：

- ✅ **遍在性**: ほぼすべてのLinux/Unixサーバーに最初からインストールされている
  - クラウドサーバーでトラブル対応中、GUIが使えない状況でも確実に使える
  - 他のエディタはインストールが必要だが、viは必ずある
  
- ✅ **軽量性**: SSH接続でも軽快に動く
  - 回線が遅くてもサクサク編集できる
  - メモリをほとんど使わない
  
- ✅ **効率性**: マウス不要でキーボードだけで全操作
  - 慣れると信じられないほど速く編集できる
  - 手がホームポジションから動かないので疲れない
  
- ✅ **普遍性**: 一度覚えれば50年使えるスキル
  - 1976年から基本は変わっていない
  - 今後も消えることはまずない

## 最重要ポイント:モードの概念 ⚡

### なぜ「モード」があるの？😕

これがvi/vimを初めて使う人が最も混乱するポイントです。メモ帳やWordでは、開いたらすぐ文字が打てますよね？でもvimは違います。

**理由: キーボードだけで全てを操作するため**

通常のエディタでは：
- 文字入力 → キーボード
- カーソル移動 → 矢印キー
- コピー&ペースト → マウスで選択してCtrl+C、Ctrl+V
- 保存 → メニューから選択、またはCtrl+S

vimでは：
- 文字入力 → インサートモードでキーボード
- カーソル移動 → ノーマルモードでhjklなど
- コピー&ペースト → ノーマルモードでyy、p
- 保存 → コマンドラインモードで:w

つまり、**同じキー（例えばj）でも、モードによって意味が変わる**のです：
- インサートモード: `j` → 文字「j」を入力
- ノーマルモード: `j` → カーソルを下に移動

これにより、ホームポジションから手を動かさず、全ての操作ができます！

### 主要な3つのモード

1. **ノーマルモード**（コマンドモード）
   - vim起動時のデフォルトモード
   - カーソル移動やテキスト操作を行う
   - **文字を入力しても画面に表示されない**（これが初心者の混乱ポイント！）
   - 「コマンドを実行するモード」と覚えましょう

2. **インサートモード**（挿入モード）
   - 実際に文字を入力できるモード
   - 画面下部に `-- INSERT --` と表示される（これが目印！）
   - 普通のエディタと同じように文字が打てる

3. **コマンドラインモード**
   - ファイルの保存や終了などを行う
   - `:`で始まるコマンドを入力
   - 画面の一番下に`:`が表示される

### モード間の移動フロー 🔄

```
              vim 起動
                 |
                 v
         ┌───────────────┐
         │  ノーマル      │ ←─────┐
         │   モード      │        │
         │ （デフォルト） │        │
         └───────────────┘        │
            |    ^    |           │
      i,a,o │    │    │ :        │
            │   Esc   │           │
            v    |    v           │
    ┌──────────┐│┌──────────┐    │
    │インサート││ コマンド  │    │
    │ モード   ││ライン     │    │
    │-- INSERT││ :w :q     │────┘
    └──────────┘│└──────────┘
                │
               Esc
```

**重要な覚え方**: 
- **迷ったら`Esc`を何回か押す** → 必ずノーマルモードに戻ります
- ノーマルモードが「ホーム」、他のモードは「部屋」のイメージ

## 基本の操作フロー 🔄

```
     vim ファイル名
          |
          v
    ┌─────────────┐
    │ノーマルモード│ ← Esc を押すといつでもここに戻る
    │ （起動直後）  │
    └─────────────┘
          |
          | 'i' を押す（insertの頭文字）
          v
    ┌─────────────┐
    │インサートモード│ ← 普通に文字入力できる
    │-- INSERT -- │    （画面下部に表示）
    └─────────────┘
          |
          | Esc を押す（編集終了）
          v
    ┌─────────────┐
    │ノーマルモード│
    └─────────────┘
          |
          | ':' を押す
          v
    ┌─────────────┐
    │コマンドライン │
    │ :wq + Enter │ ← w=write(保存), q=quit(終了)
    └─────────────┘
          |
          v
      保存して終了
```

## ファイルを開く・作成する 📂

```bash
vim ファイル名.txt
```

ファイルが存在すれば開き、存在しなければ新規作成されます。

**疑問: 新規ファイルなのに何も書いてなくても「保存」って必要？🤔**

答え: はい！vimは「ファイルを開いた」だけの状態です。内容を書いて`:wq`で初めてファイルとして保存されます。何も書かずに`:q`で終了すると、ファイルは作成されません。

## インサートモードへの入り方 📝

ノーマルモードから以下のキーで挿入モードに入れます：

- `i` : カーソル位置から入力開始（**i**nsert の頭文字）
- `a` : カーソルの次の位置から入力開始（**a**ppend = 追加）
- `o` : 現在行の下に新しい行を作って入力開始（**o**pen line below）
- `O` : 現在行の上に新しい行を作って入力開始（**O**pen line above）

**疑問: iとaの違いって何？😕**

カーソルが文字「A」の上にあるとします：
```
ABC
↑カーソルここ
```

- `i`を押す → 「A」の**前**に入力: `新ABC`
- `a`を押す → 「A」の**後**に入力: `A新BC`

実際に使ってみると違いがよくわかります！

**インサートモードを抜けるには**: `Esc`キーを押す（何回押してもOK！）

## カーソル移動(ノーマルモード) ↔️

### なぜhjkl？矢印キーじゃダメなの？🤔

これには歴史的理由があります：
1. viが作られた1976年当時、キーボードに**矢印キーがなかった**
2. hjklは**ホームポジション**にあるので、手を動かさなくて済む
3. 慣れると矢印キーより**圧倒的に速い**

```
キーボードの配置:
     k (上)
     ↑
h ← ● → l
     ↓
     j (下)
```

### 基本移動 ⌨️

- `h` : 左 ← （キーボード上で一番左にある）
- `j` : 下 ↓ （**j**ump down のイメージ、下に飛び出ているイメージ）
- `k` : 上 ↑ （**k**ick up のイメージ）
- `l` : 右 → （キーボード上で一番右にある）

**矢印キーも使えます**が、hjklの方が効率的です。最初は矢印キーでOK、徐々にhjklに移行しましょう。

### 便利な移動 🚀

- `w` : 次の単語の先頭へ（**w**ord = 単語）
- `b` : 前の単語の先頭へ（**b**ack）
- `0` (ゼロ) : 行の先頭へ（0番目の位置）
- `$` : 行の末尾へ（正規表現で$は行末を意味する）
- `gg` : ファイルの先頭へ（**g**o to top を2回）
- `G` : ファイルの末尾へ（**G**o to bottom、大文字に注意！）
- `:数字` + Enter : 指定行番号へジャンプ（例: `:50`で50行目へ）

**疑問: なぜ行末が$なの？😕**

これは**正規表現**という文字列パターンマッチングの記法から来ています。プログラミングの世界では：
- `^` = 行の先頭
- `$` = 行の末尾
を意味します。vimはこの慣習を採用しました。

## テキストの削除(ノーマルモード) ✂️

- `x` : カーソル位置の1文字を削除（ハサミで✂️切るイメージ）
- `dd` : 現在行を削除（**d**elete line を2回）
- `dw` : 単語を削除（**d**elete **w**ord）
- `D` : カーソル位置から行末まで削除（**D**elete to end）

**疑問: なぜdを2回？ddって何？🤔**

vimのコマンドには**繰り返しルール**があります：
- `d` = delete（削除）コマンド
- `d` + 移動コマンド = その範囲を削除

例：
- `dw` = delete word（単語を削除）
- `d$` = delete to end（行末まで削除）
- `dd` = delete line（行全体を削除、特別な省略形）

同じコマンドを2回打つと「行全体」に作用するのがvimのルールです！

**重要**: 削除したテキストは自動的にクリップボードにコピーされます（これを**ヤンク**と呼びます）

## コピー&ペースト(ノーマルモード) 📋

- `yy` : 現在行をコピー（**y**ank = ヤンク）
- `p` : カーソルの下にペースト（**p**aste）
- `P` : カーソルの上にペースト（**P**aste above、大文字）

**疑問: ヤンクって何？なぜコピーじゃないの？😕**

「yank」は英語で「ぐいっと引く」という意味です。テキストを「引っ張って取り出す」イメージです。

なぜ「copy」じゃないのか？
- `c`は既に**c**hange（変更）コマンドで使われている
- vimの作者が「yank」という言葉を選んだ（歴史的理由）

ちなみに、`dd`で削除したテキストもヤンクされているので、`p`でペーストできます！つまり、削除は実質「切り取り」です。

## アンドゥ(元に戻す)とリドゥ ↩️

- `u` : 元に戻す（**U**ndo）
- `Ctrl + r` : やり直し（**R**edo）

**これが最重要！** 間違えても`u`で戻せるので、恐れずに色々試しましょう！

**疑問: 何回まで戻せるの？🤔**

vimのデフォルトでは**1000回**まで戻せます！設定で変更も可能です。

## 検索(ノーマルモード) 🔍

- `/検索語` : 下方向へ検索（スラッシュ / = 前へ進む）
- `?検索語` : 上方向へ検索（疑問符 ? = 後ろを振り返る）
- `n` : 次の検索結果へ（**n**ext）
- `N` : 前の検索結果へ（前の**N**ext、大文字）

例: `/hello` と入力してEnterを押すと"hello"を下方向に検索

**Tips**: 
- 検索中にハイライトが邪魔になったら`:noh`（no highlight）で消せます
- 大文字小文字を区別したくない場合は`:set ic`（ignore case）

## 保存と終了(コマンドラインモード) 💾

ノーマルモードで`:`を押すとコマンドラインモードに入ります：

- `:w` : 保存（**W**rite = 書き込む）
- `:q` : 終了（**Q**uit = 辞める）
- `:wq` または `:x` : 保存して終了（write + quit）
- `:q!` : 保存せずに強制終了（`!` = 強制）
- `:w ファイル名` : 別名で保存（名前を付けて保存）

**疑問: なぜコロン:なの？🤔**

`:` は「これからコマンドを入力しますよ」という合図です。Exコマンド（行編集コマンド）の名残です。

**疑問: !（ビックリマーク）は何？🤔**

Unixの世界では`!`は「強制実行」を意味します：
- `:q` → 「終了してもいい？（保存してない変更があるけど大丈夫？）」
- `:q!` → 「いいから終了しろ！（変更は捨てる！）」

## よくある問題と解決法 🆘

### 「文字が入力できない！」😱

**原因**: インサートモードに入っていません

**解決法**: 
1. `Esc`を押してノーマルモードに戻る
2. `i`キーを押してインサートモードに入る
3. 画面下部に`-- INSERT --`と表示されるか確認

### 「変なコマンドが実行されてしまう！」😱

**原因**: ノーマルモードで文字を打っているため、その文字がコマンドとして解釈されています

**解決法**: 
1. `Esc`を数回押してノーマルモードに戻る
2. `u`を押してアンドゥ（元に戻す）
3. `i`を押してインサートモードに入ってから文字を入力

### 「終了できない！」😱

**原因**: 保存していない変更があるか、モードが違う

**解決法**:
```
パターン1: 保存していない変更がある
→ Esc → :wq （保存して終了）
または
→ Esc → :q! （保存せずに強制終了）

パターン2: どのモードにいるか分からない
→ Esc を3回押す → :q! → Enter
```

**緊急脱出コマンド**: `Esc Esc Esc :q! Enter`
これを覚えておけば必ず終了できます！

### 「画面が固まった！」😱

**原因**: `Ctrl + s`を押してしまった可能性が高いです

**完全解説：なぜCtrl + sで画面が固まるの？**

これは、vimの問題ではなく、**ターミナルの古い機能**が原因です。

#### 歴史的背景：1960年代の通信事情 📠

1960年代、コンピュータとの通信は**電話回線**を使っていました：
- コンピュータ → 電話線 → テレタイプ（印字機）
- データが速く流れすぎると、印字機が追いつけない
- 紙詰まりやインク切れが起きる

そこで**フロー制御**という仕組みが生まれました：

```
印字機: 「ちょっと待って！紙詰まりしそう！」
        ↓
     Ctrl + s (XOFF信号) を送信
        ↓
コンピュータ: データ送信を一時停止
        ↓
印字機: 「OK、準備できた！続けて！」
        ↓
     Ctrl + q (XON信号) を送信
        ↓
コンピュータ: データ送信を再開
```

これを**XON/XOFF フロー制御**と呼びます：
- **XOFF** (Transmission OFF) = 送信停止 = `Ctrl + s`
- **XON** (Transmission ON) = 送信再開 = `Ctrl + q`

#### なぜ今も残っているの？🤔

現代では電話回線も印字機も使いませんが、**互換性**のため、多くのターミナルエミュレータ（Macのターミナル、Windows のPowerShellなど）では、この機能がデフォルトで**有効**になっています。

#### 何が起きているの？

`Ctrl + s`を押すと：
1. ターミナルが「画面への出力を停止」する
2. vimは動いているが、**画面表示が更新されない**
3. キーを押しても反応がないように見える（実際は内部で動いている）
4. 画面が「固まった」ように見える

実際には固まっていません！ただ表示が止まっているだけです。

**解決法**: 
```
Ctrl + q を押す → 画面表示が再開される
```

**予防策**: この機能を無効にする
```bash
# ~/.bashrc または ~/.zshrc に追加
stty -ixon
```

これでCtrl + sを押しても画面が固まらなくなります！

**豆知識**: 
- 古いUnix使いの人は「Ctrl + s で止めて、ゆっくり画面を読む」という技を使っていました
- 現代では**画面スクロール**や**ページャー（lessコマンド）**があるので不要です

### 「Ctrl + zを押したら消えた！」😱

**原因**: プログラムがバックグラウンドに送られました（終了していません）

**解決法**:
```bash
fg  # foregroundの略、vimが戻ってきます
```

または、完全に終了させたい場合：
```bash
jobs  # バックグラウンドのプロセスを確認
kill %1  # ジョブ番号1のプロセスを終了
```

**教訓**: `Ctrl + z`は「一時停止」であって「終了」ではありません！

## 練習方法 📚

### 1. vimtutor（超おすすめ！）🌟

ターミナルで以下を入力：
```bash
vimtutor
```

または日本語版：
```bash
vimtutor ja
```

**これが最高の学習方法です！**
- 30分程度の対話型チュートリアル
- 実際に操作しながら学べる
- 基本操作が一通り身につく

### 2. 実践練習: 簡単なメモファイルを作る

```bash
vim practice.txt
```

以下を試してみましょう：
1. `i`でインサートモード → 何か文章を書く
2. `Esc` → `:w` → Enter で保存
3. `o` → 新しい行に何か書く
4. `dd` → 行を削除
5. `u` → 元に戻す
6. `yy` → 行をコピー
7. `p` → ペースト
8. `:wq` → 保存して終了

### 3. 毎日少しずつ 🐢

**1日目**: `i`、`Esc`、`:wq`だけ覚える
**2日目**: `hjkl`でカーソル移動
**3日目**: `dd`、`yy`、`p`
**4日目**: `u`、`/検索`
...

焦らず、1つずつ確実に！

## 初心者が最初に覚えるべき最小限のコマンド 🌱

```
┌─────────────────────────────┐
│ vim ファイル名               │ ← ファイルを開く
│                             │
│ i                           │ ← 文字入力モードへ
│ (文字を入力)                 │
│                             │
│ Esc                         │ ← ノーマルモードに戻る
│                             │
│ :wq                         │ ← 保存して終了
│ Enter                       │
└─────────────────────────────┘
```

**これだけで最低限の編集作業は可能です！**

### 緊急時の脱出方法 🚨

パニックになったら：
```
Esc Esc Esc :q! Enter
```
これで確実に終了できます（変更は保存されません）

## さらに深く理解するためのQ&A 💡

### Q: なぜvimは難しいと言われるの？

**A**: 学習曲線が独特だからです

```
普通のエディタ（メモ帳など）:
┌─┐
│ │ すぐ使える、でもずっとそのまま
└─┘

vim:
    ┌───┐
  ┌─┘   └─→ 最初は険しいが、後で急速に効率化
┌─┘
  最初    1週間   1ヶ月   3ヶ月
```

最初の2週間が辛いですが、乗り越えると驚くほど快適になります！

### Q: 他のエディタとvimの違いは？

**メモ帳・VS Code等**:
- マウスとキーボードを併用
- 目に見えるメニュー
- 直感的

**vim**:
- キーボードのみ
- コマンド覚える必要あり
- 慣れれば圧倒的に速い

### Q: プログラマーじゃないけど学ぶ価値ある？

**A**: あります！特に：
- サーバー管理者
- データアナリスト
- 科学者・研究者
- ライター（慣れれば執筆も快適）

設定ファイルの編集など、ターミナルで作業する機会があるなら必須スキルです。

## 便利な設定 ⚙️

vimは設定ファイル（`~/.vimrc`）で動作をカスタマイズできます。

初心者におすすめの設定：

```vim
" 行番号を表示
set number

" タブを半角スペース4つ分に
set tabstop=4
set shiftwidth=4
set expandtab

" 検索時に大文字小文字を区別しない
set ignorecase

" 検索語をハイライト
set hlsearch

" カーソル行をハイライト
set cursorline

" マウスを有効化（初心者向け）
set mouse=a
```

これらを`~/.vimrc`というファイルに書いて保存すると、次回起動時から有効になります。

## さらなる学習のために 📖

### 学習ロードマップ 🗺️

**レベル1（1週間）**: 
- 基本のi、Esc、:wq
- hjklでカーソル移動
- dd、yy、p

**レベル2（2週間）**:
- w、b、0、$での移動
- dw、D などの削除
- /での検索

**レベル3（1ヶ月）**:
- ビジュアルモード（v）
- 繰り返し（.コマンド）
- マクロ（q）

**レベル4（3ヶ月以降）**:
- レジスタ
- ウィンドウ分割
- プラグイン

### おすすめリソース 📚

1. **vim公式ドキュメント**: `:help`でvim内から閲覧可能
2. **Vim Adventures**: ゲーム感覚で学べるWebサイト
3. **実践Vim**: 書籍（日本語訳あり）

### 覚えておくと良い心構え 🧘

- 💪 **最初の2週間が山場**: 我慢して使い続ければ必ず慣れます
- 🎯 **完璧を目指さない**: よく使う操作から覚える（パレートの法則：20%の機能で80%の作業ができる）
- 🛡️ **エラーを恐れない**: `u`（アンドゥ）があることを忘れずに
- 🐌 **急がない**: 1日1コマンドでも十分
- 📝 **メモを取る**: よく使うコマンドをチートシートにまとめる

## チートシート（印刷して手元に！）📄

```
=== 基本中の基本 ===
i           インサートモード
Esc         ノーマルモードに戻る
:w          保存
:q          終了
:wq         保存して終了
:q!         保存せずに終了

=== 移動 ===
h j k l     左下上右
w           次の単語
b           前の単語
0           行頭
$           行末
gg          ファイル先頭
G           ファイル末尾

=== 編集 ===
dd          行削除
yy          行コピー
p           ペースト
u           アンドゥ
Ctrl+r      リドゥ

=== 検索 ===
/文字列      下方向に検索
n           次へ
N           前へ

=== 緊急脱出 ===
Esc Esc Esc :q! Enter
```

## 最後に 🎓

vimは**生涯使えるスキル**です。最初は難しく感じても、必ず「あの時学んでよかった」と思える日が来ます。

習得のコツは：
1. **毎日触る**（5分でもOK）
2. **1つずつ覚える**（欲張らない）
3. **実際に使う**（練習ファイルではなく実作業で）

あなたのvim学習を応援しています！頑張ってください！ 🚀

**Happy Vimming! 🎉**
